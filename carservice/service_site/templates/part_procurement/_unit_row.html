<tr id="unit-row-{{ unit.pk }}"
    x-data="{ 
        editMode: false,
        quantity: {{ unit.quantity|default:0 }},
        price: {{ unit.price_per_unit|default_if_none:unit.part.get_price_per_unit|default:0 }},
        originalQuantity: {{ unit.quantity|default:0 }},
        originalPrice: {{ unit.price_per_unit|default_if_none:unit.part.get_price_per_unit|default:0 }},
        cancelEdit() {
            this.quantity = this.originalQuantity;
            this.price = this.originalPrice;
            this.editMode = false;
        }
    }"
     class="{% if placed_count == unit.quantity %}table-success{% elif placed_count > 0 %}table-warning{% endif %}">
    
    <!-- Your other <td> fields here... -->
    <td>{{ unit.part.part_name }}</td>
    <td>{{ unit.part.part_brand.brand_name|default:"N/A" }}</td>
    <td>{{ unit.part.part_type.part_type_name|default:"N/A" }}</td>

    <!-- Quantity -->
    <td>
        <template x-if="editMode">
            <input type="number" class="form-control form-control-sm" x-model="quantity">
        </template>
        <template x-if="!editMode">
            <span x-text="quantity"></span>
        </template>
        </td>
    
        <!-- Price -->
        <td>
        <template x-if="editMode">
            <input type="number" step="0.01" class="form-control form-control-sm" x-model="price" name='price'>
        </template>
        <template x-if="!editMode">
            <span x-text="price + ' â‚´'"></span>
        </template>
        </td>
    
        <!-- Total -->
        <td>
        <span x-text="(quantity * price).toFixed(2) + ' â‚´'"></span>
        </td>
    
        <!-- Placed -->
        <td>
        <div class="d-flex align-items-center">
            <span class="ms-2 badge {% if placed_count == unit.quantity %}bg-success{% elif placed_count > 0 %}bg-warning{% else %}bg-secondary{% endif %}">
            {{ placed_count }}/<span x-text="quantity"></span>
            </span>
        </div>
        </td>

    <!-- Hidden fields to send via HTMX -->
    <input type="hidden" name="quantity" x-model="quantity">
    <input type="hidden" name="price" x-model="price">

    <!-- Actions -->
    <td>
      <div class="btn-group">
        <button 
            class="btn btn-sm btn-outline-primary" 
            @click="editMode ? cancelEdit() : editMode = true" 
            x-text="editMode ? 'Cancel' : 'Edit'">
        </button>


        <button class="btn btn-sm btn-outline-success" x-show="editMode"
            hx-post="{% url 'edit_unit' unit.pk %}"
            hx-include="closest tr"
            hx-target="closest tr"
            hx-swap="outerHTML"
            @click="
                editMode = false;
                originalQuantity = quantity;
                originalPrice = price;
            "
            >
        Save
        </button>

        <!-- Placements Toggle Button -->
        <button 
            class="btn btn-sm btn-outline-info"
            @click="toggleUnit('{{ unit.pk }}')"
            x-show="!isExpanded('{{ unit.pk }}')"
            hx-get="{% url 'unit_placements' unit.pk %}"
            hx-target="#placement-detail-{{ unit.pk }}"
            hx-swap="innerHTML">
        <i class="bi bi-eye"></i>
        </button>
        <button 
            class="btn btn-sm btn-outline-info"
            @click="toggleUnit('{{ unit.pk }}')"
            x-show="isExpanded('{{ unit.pk }}')">
            <i class="bi bi-eye-slash"></i>
        </button>
        <button
            class="btn btn-sm btn-outline-info"
            hx-get="{% url 'add_placement' unit.pk %}"
            hx-target="#placement-form-container-{{ unit.procurement_order.pk }}"
            hx-swap="innerHTML"
            >
            add placement
        </button>
      </div>
    </td>
</tr>