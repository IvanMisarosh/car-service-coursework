<div class="ms-2 me-auto flex-grow-1">
    <div class="fw-bold">{{v_service.service.service_name}}</div>
    <div>Category: {{v_service.service.service_type.service_type_name}}</div>

    <span x-show="!editing" >
        Qty: {{v_service.quantity}} x {{v_service.service.price}} ₴,
        {% if v_service.provided_service %}
            total (inclding parts): {{ v_service.provided_service.get_total_price }} ₴
        {% else %}
            total: {{ v_service.get_total_price }} ₴
        {% endif %}
    </span>

    <span x-show="editing">
            <input type="number" id='quantity-input-v_id-{{v_service.pk}}' name="quantity" class="form-control w-25" 
                min="1" max="100" step="1" 
                value="{{v_service.quantity}}">
    </span> 

    <div>
        {% if v_service.provided_service %}
            <span class="badge bg-success rounded-pill">
                Provided 
                {% if v_service.provided_service.provided_date %}
                    on: {{v_service.provided_service.provided_date|date:"F j, Y" }}
                {% endif %}
            </span>
            <span> by {{v_service.provided_service.employee}}</span> 
        {% else %}
            <span class="badge bg-warning rounded-pill">Pending</span>
        {% endif %}
    </div>

    {% if v_service.provided_service %}
        <div x-data="{ show_used_parts: false, button_text: 'Show'}">
            <button class="btn btn-sm btn-outline-primary me-2 mt-2" @click="show_used_parts = !show_used_parts; button_text = show_used_parts ? 'Hide' : 'Show'">
                <i class="bi bi-tools"></i> 
                <span x-text='button_text'></span>
                Used parts
            </button>
            <div x-show="show_used_parts" class="bg-light p-2 rounded mt-2 w-100">
                <ul class="list-group">
                    {% for r_part in v_service.provided_service.required_parts.all %}
                        <li class="list-group-item">
                            <div>
                                <span class="fw-bold">  
                                    {{r_part.part_in_station.part.part_name}},
                                </span>
                                <span>  
                                    category: {{r_part.part_in_station.part.part_type.part_type_name}}
                                </span>
                            </div>
                            <span>Qty: {{r_part.quantity}} x {{r_part.get_part_price}} ₴, total: {{ r_part.get_total_price }} ₴</span>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}

    {% if v_service.service.description %}
        <p class="mb-1">{{service.description}}</p>
    {% endif %}
</div>
<div class="d-flex align-items-center">
    {% if not v_service.provided_service %}
        <button class="btn btn-sm btn-outline-primary me-2" @click="editing = true" x-show="!editing">
            <i class="bi bi-pencil"></i> 
            Edit
        </button>

        <button class="btn btn-sm btn-outline-primary me-2" @click="editing = false" x-show="editing">
            Cancel
        </button>

        <button class="btn btn-sm btn-outline-primary me-2" @click="editing = false" x-show="editing"
            hx-post="{% url 'visit-service' v_service.pk %}"
            hx-target="closest .list-group-item"
            hx-swap="innerHTML"
            hx-include="#quantity-input-v_id-{{v_service.pk}}"
            >
            Save
        </button>

        {% csrf_token %}
        <button class="btn btn-sm btn-close btn-danger" 
                hx-delete="{% url 'visit-service' v_service.pk %}" 
                hx-target="closest .list-group-item"
                hx-swap="outerHTML"
                hx-confirm="Are you sure you want to delete this service?"
                >
                
        </button>
    {% endif %}
</div>